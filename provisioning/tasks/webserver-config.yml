---
- name: Add Apache virtualhost for Drupal 8 development.
  template: >
    src=templates/drupal.dev.conf.j2
    dest=/etc/apache2/sites-available/{{ domain }}.dev.conf
    owner=root group=root mode=644
  notify: restart apache

- name: Symlink Drupal virtualhost to sites-enabled.
  file: >
    src=/etc/apache2/sites-available/{{ domain }}.dev.conf
    dest=/etc/apache2/sites-enabled/{{ domain }}.dev.conf
    state=link
  notify: restart apache

- name: Remove default virtualhost file.
  file: >
    path=/etc/apache2/sites-enabled/000-default
    state=absent
  notify: restart apache

- name: Enable upload progress via APC.
  lineinfile: >
    dest=/etc/php5/conf.d/20-apc.ini
    regexp="^apc\.rfc1867"
    line="apc.rfc1867 = 1"
    state=present
  notify: restart apache
